# Caddyfile - DeBrief
# Proxy reverso para Frontend e Backend
# Caddy escuta na porta 2022 diretamente (network_mode: host)

debrief.interce.com.br {
    # Compressão automática
    encode zstd gzip

    # Proxy para API backend (/api/*)
    @api {
        path /api/*
    }
    handle @api {
        # Backend acessível via nome do serviço na rede bridge
        reverse_proxy backend:8000 {
            # Headers para proxy
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-Host {host}
            
            # Timeouts
            transport http {
                dial_timeout 10s
                response_header_timeout 60s
            }
        }
    }

    # Proxy para Frontend (tudo mais)
    # Frontend acessível via nome do serviço na rede bridge
    handle {
        reverse_proxy frontend:80 {
            # Headers para proxy
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-Host {host}
        }
    }

    # Logs
    log {
        output stdout
        format console
    }
}

